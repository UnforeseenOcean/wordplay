extend layout

block content

  <a href="https://github.com/blprnt/wordplay"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/a6677b08c955af8400f44c6298f40e7d19cc5b2d/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677261795f3664366436642e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"></a>

  .searchresults

    script(type='text/javascript', src="http://code.jquery.com/jquery-1.9.1.min.js")
    script.

      var endPoint = "http://wordplay.o-c-r.org/wp/";
      //endPoint = "http://127.0.0.1:12892/wp/";

      var resultCount = 0;
      var originalHeight = $(window).height();
      console.log("ORIGINAL HEIGHT:" + originalHeight);
      positionInput();

      var possibleStarts = [
        "a terrible fate",
        "four strong winds",
        "before the storm",
        "highway to the danger zone",
        "killing me softly",
        "a question about scales",
        "forsooth!",
        "the fog of war",
        "your mighty castle"
      ]

      var startInput = possibleStarts[Math.floor(Math.random() * possibleStarts.length)];
      var startCount = 0;

      var timer = setInterval(doTyping, 100);

      function doTyping() {
        startCount ++;
        $('#searchText').val(startInput.substr(0,startCount));
        if (startCount == startInput.length) {
          $("#wordForm").submit();
          clearInterval(timer);
        }
      }

      function submitForm(txt) {
        if (txt) $('#searchText').val(txt);  
        var corp = document.getElementById("corpusID").value;
        var txt = document.getElementById("searchText").value;
        console.log("QUERY:" + txt);
        var json = $.getJSON(endPoint + corp + "/" + txt, function(data) {
          console.log("JSON RECEIVED")
          processResults(data);
        }); 

      }

      function positionInput() {
        var pos = (originalHeight/2 - (resultCount * 10));
        $('.searchresults').animate({'top': pos}, 300, "swing", function() {

        });
        console.log(resultCount + ":" + pos);
      }

      function clearResults() {
        $(".results").empty();
        resultCount = 0;
      }

      function processResults(json) {

        clearResults();

        $(".result-list").remove();

        for(var i = 0; i < json.results.length; i++) {
          var txt = json.results[i].segment;
          var sent = json.results[i].sentence;
          console.log("sentence:" + sent);
          $( "<div/>", {
           "class": "result-item",
           "id": "result" + i,
           html: "<a href='#' title='" + sent + "''>" + txt + "</a>"
          }).appendTo( ".results" );

          $("#result" + i).css('opacity', 0);
          $("#result" + i).click(function() {
            console.log($(this).text());
            submitForm($(this).text());
          });
          $("#result" + i).animate({opacity:1}, 100 + (i * 50), function() {
            console.log("ANIMATION FINISHED.");
          });

          resultCount ++;
        }

        positionInput();

      }

    form(name="login", action="JavaScript:submitForm()", method="post" id="wordForm")
        select(name="corpus" id="corpusID" onchange='this.form.submit()')
          option(value="shakes") Shakespeare
          option(value="bible") Bible
          option(value="freud") Freud
          option(value="mobydick") Moby Dick
          option(value="bieber") Bieber
        input(type="text", name="user", id="searchText" value="" autofocus)

    .results
  